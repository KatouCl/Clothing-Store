@model IEnumerable<KS.ViewModels.Order.OrderListVm>

@{
    ViewBag.Title = "Заказы";
    Layout = "_AdminLayout";
}

<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="tab">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" href="#tab-1" data-bs-toggle="tab" role="tab" aria-selected="true">Заказы</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#tab-2" data-bs-toggle="tab" role="tab" aria-selected="false">График</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="tab-1" role="tabpanel">
                        <div class="row pt-5">
                            <div class="col-md-10">

                                <div class="row">
                                    <div class="col-md-3"></div>
                                    <div class="col-md-3"></div>
                                    <form asp-area="Admin" asp-controller="Order" method="post">
                                        <div class="col-md-3">
                                            <input type="date" id="start" name="trip-start" class="form-control flatpickr-minimum flatpickr-input" placeholder="Начало переода"
                                                   value=""
                                                   min="2021-01-01" max="2045-12-31">
                                        </div>
                                        <div class="col-md-3">
                                            <input type="date" id="start" name="trip-start" class="form-control flatpickr-minimum flatpickr-input" placeholder="Конец переода"
                                                   value=""
                                                   min="2021-01-01" max="2045-12-31">
                                        </div>
                                    </form>
                                </div>


                                <!-- Output -->
                                @if (Model.Any())
                                {
                                    <div class="card-body">
                                        <table class="table table-striped" style="width:100%">
                                            <thead>
                                            <tr>
                                                <th>Клиент</th>
                                                <th>Количество</th>
                                                <th>Сумма</th>
                                                <th>Дата создания</th>
                                                <th></th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            @foreach (var order in Model)
                                            {
                                                <tr>
                                                    <td>@order.Customer</td>
                                                    <td>@order.QuantityProduct</td>
                                                    <td>₽ @order.Price.ToString("0")</td>
                                                    <td>@order.CreationDate.ToString("d")</td>
                                                    <td>
                                                        <a asp-area="Admin" asp-controller="Order" asp-action="OrderDetails" asp-route-orderId="@order.Id">Подробнее</a>
                                                    </td>
                                                </tr>
                                            }
                                            </tbody>
                                        </table>
                                    </div>
                                }
                                else
                                {
                                    <div class="text-center"></div>
                                }
                            </div>
                        </div>
                    </div>

                    @* <div class="tab-pane" id="tab-2" role="tabpanel"> *@
                    @*     <div class="pt-5"> *@
                    @*         <div class="card flex-fill w-100"> *@
                    @*             <div class="card-header"> *@
                    @*                 <h5 class="card-title">Заказы</h5> *@
                    @*                 <h6 class="card-subtitle text-muted">Линейная диаграмма заказов</h6> *@
                    @*             </div> *@
                    @*             <div class="card-body"> *@
                    @*                 <div class="chart"> *@
                    @*                     <div class="chartjs-size-monitor"> *@
                    @*                         <div class="chartjs-size-monitor-expand"> *@
                    @*                             <div class=""></div> *@
                    @*                         </div> *@
                    @*                         <div class="chartjs-size-monitor-shrink"> *@
                    @*                             <div class=""></div> *@
                    @*                         </div> *@
                    @*                     </div> *@
                    @*                     <canvas id="chartjs-line" style="display: block; height: 300px; width: 528px;" width="660" height="375" class="chartjs-render-monitor"></canvas> *@
                    @*                 </div> *@
                    @*             </div> *@
                    @*         </div> *@
                    @*     </div> *@
                    @* </div> *@
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	$.getJSON("/Chart/Order", function(data) {
	  document.addEventListener("DOMContentLoaded", function() {
	  		var Price = @Html.Raw(Json.Serialize(ViewBag.Price));
	  		var Qts = []
	  		for (var i =0; i < data.length; i++){
	  			Price.push(data[i]);
	  			Qts.push(data[i]);
	  			}
      			// Line chart
      			new Chart(document.getElementById("chartjs-line"), {
      				type: "line",
      				data: {
      					labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
      					datasets: [{
      						label: "Продаж (₽)",
      						fill: true,
      						backgroundColor: "transparent",
      						borderColor: window.theme.primary,
      						data: Price
      					}]
      				},
      				options: {
      					maintainAspectRatio: false,
      					legend: {
      						display: false
      					},
      					tooltips: {
      						intersect: false
      					},
      					hover: {
      						intersect: true
      					},
      					plugins: {
      						filler: {
      							propagate: false
      						}
      					},
      					scales: {
      						xAxes: [{
      							reverse: true,
      							gridLines: {
      								color: "rgba(0,0,0,0.05)"
      							}
      						}],
      						yAxes: [{
      							ticks: {
      								stepSize: 500
      							},
      							display: true,
      							borderDash: [5, 5],
      							gridLines: {
      								color: "rgba(0,0,0,0)",
      								fontColor: "#fff"
      							}
      						}]
      					}
      				}
      			});
      		});
	});
		
	</script>